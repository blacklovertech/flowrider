import{c as u,r as n,j as e}from"./index-DC7rahvd.js";import{P as T,a as C}from"./PageContainer-BHEaM04S.js";import{N as S}from"./navigation-CjZ6JO41.js";import{M as p}from"./map-pin-CMXhUZfw.js";import{C as $}from"./clock-CcT56hys.js";import{C as _}from"./check-circle-DONmyFUF.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=u("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=u("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),R=["food","grocery","courier","taxi","errands"],D=()=>{const[a,l]=n.useState({id:"R100",name:"Rahul",preferences:["grocery","courier"],status:"available"}),[o,y]=n.useState({lat:12.9716,lng:77.5946}),[j,g]=n.useState(!1),[h,f]=n.useState([]),[r,d]=n.useState(null);n.useEffect(()=>{const s=setInterval(()=>{var i;(i=navigator.geolocation)==null||i.getCurrentPosition(t=>{y({lat:t.coords.latitude,lng:t.coords.longitude})})},1e4);return()=>clearInterval(s)},[]);const m=async()=>{g(!0);try{const s=`/api/riders/${a.id}/tasks?lat=${o.lat}&lng=${o.lng}`,t=await(await fetch(s)).json();t.success&&f(t.tasks)}finally{g(!1)}};n.useEffect(()=>{m()},[a.preferences.join(","),a.status,o.lat,o.lng]);const b=async()=>{const s=a.status==="available"?"offline":"available";l(i=>({...i,status:s}));try{await fetch(`/api/riders/${a.id}/availability`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})})}catch{}},v=async s=>{const i=a.preferences.includes(s)?a.preferences.filter(t=>t!==s):[...a.preferences,s];l(t=>({...t,preferences:i}));try{await fetch(`/api/riders/${a.id}/preferences`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({preferences:i})})}catch{}},N=async s=>{try{const t=await(await fetch(`/api/tasks/${s}/assign`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({riderId:a.id})})).json();t.success&&(d(t.task),f(c=>c.filter(w=>w.id!==s)),l(c=>({...c,status:"busy"})))}catch{}},x=async s=>{if(!r)return;const t=await(await fetch(`/api/tasks/${r.id}/status`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})})).json();t.success&&(d(t.task),s==="delivered"&&(d(null),l(c=>({...c,status:"available"})),m()))},k=n.useMemo(()=>{if(!r)return null;const[s,i]=r.pickup_location,[t,c]=r.dropoff_location;return`https://www.google.com/maps/dir/${s},${i}/${t},${c}`},[r]);return e.jsxs(T,{children:[e.jsx(C,{title:"Rider App",subtitle:`Logged in as ${a.name}`,actions:e.jsxs("button",{onClick:b,className:`px-4 py-2 rounded-lg text-white flex items-center ${a.status==="available"?"bg-green-600":"bg-gray-600"}`,children:[a.status==="available"?e.jsx(P,{className:"h-4 w-4 mr-2"}):e.jsx(O,{className:"h-4 w-4 mr-2"}),a.status==="available"?"Online":"Offline"]})}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow mb-6",children:[e.jsx("h2",{className:"font-semibold mb-3",children:"My Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(s=>e.jsx("button",{onClick:()=>v(s),className:`px-3 py-2 rounded-lg text-sm capitalize ${a.preferences.includes(s)?"bg-blue-600 text-white":"bg-gray-100 text-gray-800"}`,children:s},s))})]}),r&&e.jsxs("div",{className:"bg-green-50 border border-green-200 p-4 rounded-xl mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"font-semibold",children:["Active Task #",r.id]}),e.jsxs("a",{className:"text-blue-600 underline inline-flex items-center",href:k||"#",target:"_blank",rel:"noreferrer",children:[e.jsx(S,{className:"h-4 w-4 mr-1"})," Navigate"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-4 w-4 mr-1 text-gray-600"}),"Pickup: ",r.pickup_location.join(", ")]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-4 w-4 mr-1 text-gray-600"}),"Drop: ",r.dropoff_location.join(", ")]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx($,{className:"h-4 w-4 mr-1 text-gray-600"}),"₹",r.estimated_value]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>x("picked_up"),className:"px-3 py-2 rounded bg-yellow-600 text-white text-sm",children:"Picked Up"}),e.jsx("button",{onClick:()=>x("en_route"),className:"px-3 py-2 rounded bg-blue-600 text-white text-sm",children:"En Route"}),e.jsx("button",{onClick:()=>x("delivered"),className:"px-3 py-2 rounded bg-green-600 text-white text-sm",children:"Delivered"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"font-semibold",children:"Available Tasks"}),e.jsx("button",{onClick:m,className:"text-sm text-blue-600",children:"Refresh"})]}),j?e.jsx("div",{className:"text-sm text-gray-500",children:"Loading..."}):h.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No tasks right now. Try expanding categories or check back soon."}):e.jsx("div",{className:"space-y-3",children:h.map(s=>{var i;return e.jsxs("div",{className:"border rounded-lg p-3 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm",children:[s.platform," • ",e.jsx("span",{className:"capitalize",children:s.category})]}),e.jsxs("div",{className:"text-xs text-gray-600 flex items-center",children:[e.jsx(p,{className:"h-3 w-3 mr-1"})," ",s.pickup_location.join(", ")," → ",s.dropoff_location.join(", ")]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["Distance: ",(i=s.distance_km)==null?void 0:i.toFixed(2)," km"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-sm font-semibold",children:["₹",s.estimated_value]}),e.jsxs("button",{onClick:()=>N(s.id),className:"px-3 py-1 rounded bg-green-600 text-white text-sm inline-flex items-center",children:[e.jsx(_,{className:"h-4 w-4 mr-1"}),"Accept"]})]})]},s.id)})})]})]})};export{D as default};
